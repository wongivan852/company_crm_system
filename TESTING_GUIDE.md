# üß™ Testing Guide for CRM Application\n\n## Test Coverage Overview\n\nThe CRM application now includes comprehensive tests covering:\n\n### ‚úÖ Model Tests\n- **Customer Model**: Creation, validation, properties, address fields\n- **Course Model**: Basic functionality and validation\n- **Enrollment Model**: Creation and constraints\n- **Communication Models**: Logging and preferences\n\n### ‚úÖ Form Tests\n- **CustomerForm**: Validation, required fields, email validation\n- **Form Integration**: Field validation and error handling\n\n### ‚úÖ API Tests\n- **Authentication**: Token-based authentication\n- **CRUD Operations**: Create, Read, Update, Delete customers\n- **Permissions**: Unauthorized access handling\n- **Throttling**: Rate limiting (disabled in tests)\n\n### ‚úÖ View Tests\n- **Public Views**: UAT access token validation\n- **CSV Export**: Authentication requirements\n- **Frontend Views**: Login requirements\n\n### ‚úÖ Utility Tests\n- **CSV Generation**: Export functionality\n- **UAT Validation**: Access control logic\n- **Helper Functions**: Data processing\n\n### ‚úÖ Communication Tests\n- **WhatsApp Service**: Message sending (mocked)\n- **Communication Logging**: Message tracking\n- **Service Integration**: API communication\n\n### ‚úÖ Security Tests\n- **Configuration**: SECRET_KEY, DEBUG, ALLOWED_HOSTS\n- **Authentication**: Access control\n- **Token Validation**: UAT security\n\n### ‚úÖ Integration Tests\n- **Complete Workflows**: Customer creation to enrollment\n- **Data Flow**: End-to-end functionality\n- **CSV Export**: Data consistency\n\n## Running Tests\n\n### Method 1: Using Django's test runner\n```bash\ncd crm_project\npython manage.py test --settings=test_settings\n```\n\n### Method 2: Using the custom test runner\n```bash\ncd crm_project\npython ../run_tests.py\n```\n\n### Method 3: Using pytest (if installed)\n```bash\npip install pytest pytest-django\npytest --ds=test_settings\n```\n\n### Method 4: Run specific test classes\n```bash\npython manage.py test crm.tests.CustomerModelTest --settings=test_settings\npython manage.py test crm.tests.APITestCase --settings=test_settings\npython manage.py test crm.tests.SecurityTest --settings=test_settings\n```\n\n## Test Configuration\n\n### Test Database\n- Uses SQLite in-memory database for speed\n- No migrations applied (disabled for performance)\n- Isolated test environment\n\n### Test Settings\n- Separate `test_settings.py` configuration\n- Disabled logging and security features for testing\n- Mock external services (WhatsApp, WeChat)\n- Faster password hashing\n\n### Mocking\n- External API calls are mocked\n- Communication services use test credentials\n- File system operations use temporary directories\n\n## Test Data\n\nTests use factory methods and fixtures:\n```python\n# Example test customer\ncustomer_data = {\n    'first_name': 'John',\n    'last_name': 'Doe',\n    'email_primary': 'john.doe@example.com',\n    'customer_type': 'individual',\n    'status': 'active',\n}\n```\n\n## Coverage Report\n\nTo generate test coverage reports:\n```bash\npip install coverage\ncoverage run --source='.' manage.py test --settings=test_settings\ncoverage report\ncoverage html  # Generates HTML report\n```\n\n## Continuous Integration\n\n### GitHub Actions Example\n```yaml\nname: Tests\non: [push, pull_request]\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v2\n    - name: Set up Python\n      uses: actions/setup-python@v2\n      with:\n        python-version: 3.8\n    - name: Install dependencies\n      run: |\n        pip install -r requirements.txt\n    - name: Run tests\n      run: |\n        cd crm_project\n        python manage.py test --settings=test_settings\n```\n\n## Test Best Practices\n\n### ‚úÖ What's Covered\n- Model validation and business logic\n- API endpoint functionality\n- Authentication and authorization\n- Form validation\n- Utility functions\n- Security configuration\n- Integration workflows\n\n### ‚ùå What's Not Covered (Future Improvements)\n- Frontend JavaScript testing\n- Load testing\n- Database performance testing\n- Email sending (uses console backend)\n- File upload functionality\n- Background task testing (Celery)\n\n## Running Tests in Different Environments\n\n### Development\n```bash\nDJANGO_SETTINGS_MODULE=test_settings python manage.py test\n```\n\n### Production Validation\n```bash\n# Use production-like settings but with test database\nDJANGO_SETTINGS_MODULE=production_test_settings python manage.py test\n```\n\n## Debugging Tests\n\n### Verbose Output\n```bash\npython manage.py test --verbosity=2 --settings=test_settings\n```\n\n### Keep Test Database\n```bash\npython manage.py test --keepdb --settings=test_settings\n```\n\n### Run Single Test\n```bash\npython manage.py test crm.tests.CustomerModelTest.test_customer_creation --settings=test_settings\n```\n\n## Test Maintenance\n\n- Update tests when models change\n- Add tests for new features\n- Mock external dependencies\n- Keep test data minimal and focused\n- Use descriptive test names\n- Group related tests in classes\n\n## Performance\n\n- Tests run in ~30-60 seconds\n- In-memory database for speed\n- Disabled migrations\n- Simplified password hashing\n- Mocked external services\n\nThis comprehensive test suite provides confidence in the application's core functionality and helps prevent regressions during development.